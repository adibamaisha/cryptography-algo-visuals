import hashlib
from typing import Dict, List

class VulnerabilityScanner:
    def __init__(self):
        self.weak_configs = {
            'AES': {
                'weak_key_sizes': [128],  # 128-bit is still strong but 256 is recommended
                'weak_modes': ['ECB'],
                'recommendations': {
                    'key_size': 'Use 256-bit keys for long-term security',
                    'mode': 'Use GCM mode for authenticated encryption'
                }
            },
            'RSA': {
                'weak_key_sizes': [1024],
                'recommendations': {
                    'key_size': 'Use 2048-bit or higher for RSA keys'
                }
            }
        }
    
    def scan_algorithm_config(self, algorithm: str, key_size: int, mode: str = None) -> Dict:
        """Scan algorithm configuration for potential vulnerabilities"""
        vulnerabilities = []
        recommendations = []
        security_score = 100  # Start with perfect score
        
        algo_config = self.weak_configs.get(algorithm, {})
        
        # Check key size
        if key_size in algo_config.get('weak_key_sizes', []):
            vulnerabilities.append(f"Weak key size: {key_size}-bit")
            security_score -= 30
        
        # Check mode
        if mode in algo_config.get('weak_modes', []):
            vulnerabilities.append(f"Insecure mode: {mode}")
            security_score -= 40
        
        # Add recommendations
        if algo_config.get('recommendations'):
            recommendations.extend(algo_config['recommendations'].values())
        
        return {
            'algorithm': algorithm,
            'key_size': key_size,
            'mode': mode,
            'vulnerabilities': vulnerabilities,
            'recommendations': recommendations,
            'security_score': max(security_score, 0),
            'risk_level': self._get_risk_level(security_score)
        }
    
    def _get_risk_level(self, score: int) -> str:
        if score >= 80:
            return "LOW"
        elif score >= 60:
            return "MEDIUM"
        elif score >= 40:
            return "HIGH"
        else:
            return "CRITICAL"
    
    def generate_security_report(self, algorithm: str, key_size: int, mode: str = None) -> str:
        """Generate a detailed security report"""
        scan_result = self.scan_algorithm_config(algorithm, key_size, mode)
        
        report = []
        report.append(f"ðŸ”’ SECURITY REPORT: {algorithm}-{key_size}-{mode if mode else ''}")
        report.append("=" * 50)
        report.append(f"Overall Risk Level: {scan_result['risk_level']}")
        report.append(f"Security Score: {scan_result['security_score']}/100")
        
        if scan_result['vulnerabilities']:
            report.append("\n  VULNERABILITIES FOUND:")
            for vuln in scan_result['vulnerabilities']:
                report.append(f"   â€¢ {vuln}")
        else:
            report.append("\n No major vulnerabilities found")
        
        if scan_result['recommendations']:
            report.append("\nðŸ’¡ RECOMMENDATIONS:")
            for rec in scan_result['recommendations']:
                report.append(f"   â€¢ {rec}")
        
        return "\n".join(report)
    